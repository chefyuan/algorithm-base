> 如果阅?时，发现错?，或者动画不?以显示的?题可以添加我?信好? **[tan45du_one](https://raw.githubusercontent.com/tan45du/tan45du.github.io/master/?人微?.15egrcgqd94w.jpg)** ，?注 github + 题目 + ?? 向我反??
>
> 感谢?持，该仓库会一直维护，希望对各位有一?丢帮助?
>
> 另?希望手机阅读的同?可以来我的 <u>[**?众号：?厨的算法小?**](https://raw.githubusercontent.com/tan45du/test/master/?信图片_20210320152235.2pthdebvh1c0.png)</u> 两个平台同?，想?和题友一起刷题，互相监督的同学，?以在我的小屋点击<u>[**刷?小?**](https://raw.githubusercontent.com/tan45du/test/master/?信图片_20210320152235.2pthdebvh1c0.png)</u>进入?

#### [42. 接雨水](https://leetcode-cn.com/problems/trapping-rain-water/)

这道接雨水也?一道特?经典的?目，一道必刷?目，我?也用单调栈来解决。下面我?来看一下?目?

给定 n ?非负整数表示每个宽度? 1 的柱子的高度图，计算按?排列的柱子，下雨之后能接?少雨水?

示例 1?

```
输入：height = [0,1,0,2,1,0,1,3,2,1,2,1]
输出?6
```

示例 2?

```
输入：height = [4,2,0,3,2,5]
输出?9
```

示例 3?

```
输入：[4,3,2,0,1,1,5]
输出?13
```

> 上面?由数? [4,3,2,0,1,1,5]表示的高度图，在这?情况下，可以接 13 ?单位的雨水（见下图）?

### 题目解析?

看了上面的示例刚开始刷题的同?可能有些懵逼，那我?结合图片来理解一下，我们就用示例 3 的例子进行举例，他的雨水到底代表的是什么?

![](https://img-blog.csdnimg.cn/2021032013412768.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMzODg1OTI0,size_16,color_FFFFFF,t_70)

上图则为我们的?目描述，是不是理解了呢？你也可以这样理解我?在地上放?了若干高度的黄色箱子，他??间有空隙，然后我?想在他们里面插入若干蓝色箱子，并保证插入之后，这些?子的左视图和右视图都不能看到蓝色?子?

好啦题目我们已经理解了，下面我们看一下解题思路。做这个这前我们?以先去看一下我?之前做过的另一道?目每日温度。这两道题目的思路?不?，都是利用了单调栈的思想，下面我?来看一下具体思路吧?

这里我们也系统的说一下单调栈，单调栈?义就?栈内的元素是单调的，我们这两?题目用到的都?递减栈（相同也可以），我?依?将元素压入栈，如果当前元素小于等于栈顶元素则入栈，如果大于栈顶元素则先将栈顶不?出栈，直到当前元素小于或等于栈顶元素为??，然后再将当前元素入栈。就比?下图的 4，想入栈的话则需? 2?3 出栈之后才能入栈，因? 4 大于他俩?

<img src="https://img-blog.csdnimg.cn/20210320134154434.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMzODg1OTI0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描?" style="zoom:80%;" />

我们了解单调栈的?义下面我?来看一下接雨水?题到底?怎么做，其实原理也很简单，我们通过我们的例 3 来进行?明?

首先我们依?入? 4?3?2?0 我们的数组前四个元素?符合单调栈?则的。但?我们的??五个 1，是大于 0 的。那我们就需? 0 出栈 1 入栈。但?我们这样做是为了什么呢？有什么意义呢？别急我?来看下图?

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210320134213324.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMzODg1OTI0,size_16,color_FFFFFF,t_70)

上图我们的，4?3?2?0 已经入栈了，我们的另一?元素? 1，栈顶元素为 0，栈顶下的元素为 2。那么我?在这一层接到的雨水数量怎么算呢?2?0?1 这三?元素?以接住的水为一?单位(见下?)这是我们?一层接到水的数量?

?：能接到水的情况，肯定是?间低两边高，这样才可以?

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210320134228696.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMzODg1OTI0,size_16,color_FFFFFF,t_70)

因为我们需要维护一?单调栈，所以我?则需要将 0 出栈 1 入栈，那么?时栈内元素? 4?3?2?1。下一位元素为 1，我?入栈，?时栈内元素? 4?3?2?1?1。下一元素? 5，栈顶元素为 1，栈顶的下一元素仍为 1，则需要再下一?元素，为 2，那我们求当前层接到的水的数量?

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210320134249605.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMzODg1OTI0,size_16,color_FFFFFF,t_70)

我们?通过 2?1?1?5 这四?元素求得?二层的接水数? 1\*3=3;1 ?因为 min(2-1,5-1)=min(1,4)得来的，大?可以思考一下木桶效应。?水的?少，肯定是按最?的那?木板来的，所以高度为 1?3 的话?因为 5 的索引为 6?2 的索引为 2，他?之间共有三个元素?3?4?5）也就是 3 ?单位。所以为 6-2-1=3?

? 1 出栈之后，我?栈顶元素就变成了 2，下一元素变成? 3，那? 3?2?5 这三?元素同样也可以接到水?

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210320134307389.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMzODg1OTI0,size_16,color_FFFFFF,t_70)

这是?三层的接水情况，能?接? 4 ?单位的水，下面我?继续出栈 2，那么我?? 4?3?5 仍然?以接到水啊?

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210320134319646.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMzODg1OTI0,size_16,color_FFFFFF,t_70)

这是我们?四层接水的情况，一共能够接? 5 ?单位的水，那么我?总的接水数加起来，那就是

1+3+4+5=13。你学会了吗？别急还有??我?，我?再来深入理解一哈?

![](https://img-blog.csdnimg.cn/20210319163622150.gif)

### 题目代码?

```java
class Solution {
    public int trap(int[] height) {
         Stack<Integer> stack = new Stack<Integer>();
         int water = 0;
         //特殊情况
         if(height.length <3){
             return 0;
         }
         for(int i = 0; i < height.length; i++){
             while(!stack.isEmpty() && height[i] > height[stack.peek()]){
                 //栈顶元素
                 int popnum = stack.pop();
                 //相同元素的情况例1?1
                 while(!stack.isEmpty()&&height[popnum] == height[stack.peek()]){
                     stack.pop();
                 }
                 //计算该层的水的单?
                 if(!stack.isEmpty()){
                     int temp = height[stack.peek()];//栈顶元素?
                     //?
                     int hig = Math.min(temp-height[popnum],height[i]-height[popnum]);
                     //?
                     int wid = i-stack.peek()-1;
                     water +=hig * wid;
                 }

             }
             //这里入栈的是索引
             stack.push(i);
         }
         return water;
    }
}
```

**GO?言版本?**

```go
func trap(height []int) int {
    stack := []int{}
    water := 0
    // 最左边部分不会接雨水，左边持续升高时，stack都会弹出所有元素?
    for i := 0; i< len(height); i++ {
        for len(stack) != 0 && height[i] > height[stack[len(stack) - 1]] {
            popnum := stack[len(stack) - 1]
            // 出现相同高度的情况（其实也可以不用?理，?果不?理，相同高度时后面的hig?0，会产生很?无效的计算?
            for len(stack) != 0 && height[popnum] == height[stack[len(stack) - 1]] {
                stack = stack[:len(stack) - 1]
            }
            if len(stack) == 0 { break }
            le, ri := stack[len(stack) - 1], i
            hig := min(height[ri], height[le]) - height[popnum]
            wid := ri - le - 1
            water += wid * hig
        }
        stack = append(stack, i)
    }
    return water
}

func min(a, b int) int {
    if a < b { return a }
    return b
}
```

### 



